{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/leand/projects/carne-facil/frontend/pages/tv.js"],"sourcesContent":["// Fun√ß√£o para formatar o n√∫mero do ticket\r\n  const formatTicketNumber = (ticket) => {\r\n    // Usar o campo 'number' se existir, sen√£o usar o ID formatado\r\n    const displayNumber = ticket.number || ticket.id;\r\n    return String(displayNumber).padStart(3, '0');\r\n  };import { useState, useEffect } from 'react';\r\n\r\nexport default function TVDisplay() {\r\n  const [tickets, setTickets] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n\r\n  // Atualizar hor√°rio a cada segundo\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      setCurrentTime(new Date());\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  // Buscar tickets\r\n  const fetchTickets = async () => {\r\n    console.log('Buscando tickets...');\r\n    try {\r\n      const response = await fetch('http://localhost:4000/tickets');\r\n      console.log('Response status:', response.status);\r\n      const data = await response.json();\r\n      console.log('Tickets recebidos:', data);\r\n      \r\n      if (response.ok) {\r\n        // O backend retorna { success: true, tickets: [...] } - usar data.tickets\r\n        const ticketsData = data.tickets || data || [];\r\n        setTickets(ticketsData);\r\n        setError(null);\r\n        console.log('Tickets atualizados no estado:', ticketsData.length, 'tickets');\r\n      } else {\r\n        setError(data.error || 'Erro ao carregar tickets');\r\n        console.error('Erro na resposta:', data.error);\r\n      }\r\n    } catch (err) {\r\n      setError('Erro de conex√£o: ' + err.message);\r\n      console.error('Erro de conex√£o:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Buscar tickets inicialmente e configurar atualiza√ß√£o autom√°tica\r\n  useEffect(() => {\r\n    console.log('Iniciando carregamento inicial de tickets...');\r\n    fetchTickets();\r\n    \r\n    // Atualizar a cada 5 segundos\r\n    console.log('Configurando auto-refresh a cada 5 segundos...');\r\n    const interval = setInterval(() => {\r\n      console.log('Auto-refresh executando...');\r\n      fetchTickets();\r\n    }, 5000);\r\n    \r\n    return () => {\r\n      console.log('Limpando interval de auto-refresh');\r\n      clearInterval(interval);\r\n    };\r\n  }, []);\r\n\r\n  // Configurar SSE para atualiza√ß√µes em tempo real\r\n  useEffect(() => {\r\n    console.log('Conectando ao SSE...');\r\n    const eventSource = new EventSource('http://localhost:4000/events');\r\n    \r\n    eventSource.onopen = () => {\r\n      console.log('SSE conectado com sucesso');\r\n    };\r\n    \r\n    eventSource.onmessage = (event) => {\r\n      console.log('Evento SSE recebido:', event.data);\r\n      const data = JSON.parse(event.data);\r\n      if (data.type === 'ticket_updated' || data.type === 'connected' || data.type === 'tickets_reset') {\r\n        console.log('Recarregando tickets devido ao evento:', data.type);\r\n        fetchTickets(); // Recarregar todos os tickets quando houver atualiza√ß√£o\r\n      }\r\n    };\r\n\r\n    eventSource.onerror = (error) => {\r\n      console.error('SSE Error:', error);\r\n      console.log('Estado da conex√£o SSE:', eventSource.readyState);\r\n    };\r\n\r\n    return () => {\r\n      console.log('Fechando conex√£o SSE');\r\n      eventSource.close();\r\n    };\r\n  }, []);\r\n\r\n  // Filtrar tickets por status (garantir que tickets √© um array)\r\n  const ticketsArray = Array.isArray(tickets) ? tickets : [];\r\n  console.log('Tickets no estado atual:', tickets);\r\n  console.log('Tickets como array:', ticketsArray);\r\n  \r\n  const waitingTickets = ticketsArray.filter(t => t.status === 'waiting');\r\n  const preparingTickets = ticketsArray.filter(t => t.status === 'preparing');\r\n  const completedTickets = ticketsArray.filter(t => t.status === 'completed');\r\n  \r\n  console.log('Tickets filtrados:', {\r\n    waiting: waitingTickets.length,\r\n    preparing: preparingTickets.length,\r\n    completed: completedTickets.length\r\n  });\r\n\r\n  // Fun√ß√£o para formatar hor√°rio de forma segura\r\n  const formatTime = (dateString) => {\r\n    if (!dateString) return null;\r\n    \r\n    try {\r\n      const date = new Date(dateString);\r\n      // Verificar se a data √© v√°lida\r\n      if (isNaN(date.getTime())) return null;\r\n      \r\n      return date.toLocaleTimeString('pt-BR', {\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-900 flex items-center justify-center\">\r\n        <div className=\"text-white text-2xl\">Carregando...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-900 text-white p-8\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center mb-8\">\r\n        <h1 className=\"text-5xl font-bold text-center flex-1\">\r\n          ü•© CARNE F√ÅCIL - PAINEL DE SENHAS\r\n        </h1>\r\n        <div className=\"text-right\">\r\n          <div className=\"text-2xl font-mono\">\r\n            {currentTime.toLocaleTimeString('pt-BR')}\r\n          </div>\r\n          <div className=\"text-lg text-gray-400\">\r\n            {currentTime.toLocaleDateString('pt-BR')}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"bg-red-600 text-white p-4 rounded-lg mb-6 text-center\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {/* Grid de Status */}\r\n      <div className=\"grid grid-cols-3 gap-8 h-[calc(100vh-200px)]\">\r\n        \r\n        {/* Na Fila */}\r\n        <div className=\"bg-yellow-800 rounded-lg p-6\">\r\n          <div className=\"text-center mb-6\">\r\n            <h2 className=\"text-3xl font-bold text-yellow-100 mb-2\">\r\n              üïê NA FILA\r\n            </h2>\r\n            <div className=\"text-5xl font-bold text-yellow-200\">\r\n              {waitingTickets.length}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"space-y-3 max-h-[calc(100%-120px)] overflow-y-auto\">\r\n            {waitingTickets.length === 0 ? (\r\n              <div className=\"text-center text-yellow-200 text-xl py-8\">\r\n                Nenhuma senha na fila\r\n              </div>\r\n            ) : (\r\n              waitingTickets.map((ticket) => (\r\n                <div key={ticket.id} className=\"bg-yellow-700 rounded-lg p-4 text-center\">\r\n                  <div className=\"text-3xl font-bold text-yellow-100\">\r\n                    #{formatTicketNumber(ticket)}\r\n                  </div>\r\n                  {formatTime(ticket.created_at) && (\r\n                    <div className=\"text-sm text-yellow-200 mt-1\">\r\n                      {formatTime(ticket.created_at)}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Em Preparo */}\r\n        <div className=\"bg-blue-800 rounded-lg p-6\">\r\n          <div className=\"text-center mb-6\">\r\n            <h2 className=\"text-3xl font-bold text-blue-100 mb-2\">\r\n              üë®‚Äçüç≥ EM PREPARO\r\n            </h2>\r\n            <div className=\"text-5xl font-bold text-blue-200\">\r\n              {preparingTickets.length}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"space-y-3 max-h-[calc(100%-120px)] overflow-y-auto\">\r\n            {preparingTickets.length === 0 ? (\r\n              <div className=\"text-center text-blue-200 text-xl py-8\">\r\n                Nenhuma senha em preparo\r\n              </div>\r\n            ) : (\r\n              preparingTickets.map((ticket) => (\r\n                <div key={ticket.id} className=\"bg-blue-700 rounded-lg p-4 text-center animate-pulse\">\r\n                  <div className=\"text-3xl font-bold text-blue-100\">\r\n                    #{formatTicketNumber(ticket)}\r\n                  </div>\r\n                  {formatTime(ticket.updated_at) && (\r\n                    <div className=\"text-sm text-blue-200 mt-1\">\r\n                      {formatTime(ticket.updated_at)}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Pronto para Retirar */}\r\n        <div className=\"bg-green-800 rounded-lg p-6\">\r\n          <div className=\"text-center mb-6\">\r\n            <h2 className=\"text-3xl font-bold text-green-100 mb-2\">\r\n              ‚úÖ PRONTO PARA RETIRAR\r\n            </h2>\r\n            <div className=\"text-5xl font-bold text-green-200\">\r\n              {completedTickets.length}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"space-y-3 max-h-[calc(100%-120px)] overflow-y-auto\">\r\n            {completedTickets.length === 0 ? (\r\n              <div className=\"text-center text-green-200 text-xl py-8\">\r\n                Nenhuma senha pronta\r\n              </div>\r\n            ) : (\r\n              completedTickets.map((ticket) => (\r\n                <div key={ticket.id} className=\"bg-green-700 rounded-lg p-4 text-center animate-bounce\">\r\n                  <div className=\"text-3xl font-bold text-green-100\">\r\n                    #{formatTicketNumber(ticket)}\r\n                  </div>\r\n                  {formatTime(ticket.updated_at) && (\r\n                    <div className=\"text-sm text-green-200 mt-1\">\r\n                      Pronto √†s {formatTime(ticket.updated_at)}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Footer com informa√ß√µes */}\r\n      <div className=\"mt-8 text-center text-gray-400\">\r\n        <p className=\"text-lg\">\r\n          Acompanhe sua senha pelo QR Code ‚Ä¢ Atualiza√ß√£o autom√°tica a cada 5 segundos\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}